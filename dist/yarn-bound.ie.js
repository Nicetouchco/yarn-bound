!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.YarnBound=t():e.YarnBound=t()}(this,(function(){return function(){"use strict";var e={823:function(e,t,n){n.r(t),n.d(t,{default:function(){return _e}});class s{}class i{}class a{}class r{}class o{}class l{}class d{}class c{}var h={types:{Text:s,Shortcut:i,Conditional:a,Assignment:r,Literal:o,Expression:l,FunctionCall:d,Command:c},DialogShortcutNode:class extends i{constructor(e,t,n,s=[],i){super(),this.type="DialogShortcutNode",this.text=e,this.content=t,this.lineNum=n.first_line,this.hashtags=s,this.conditionalExpression=i}},IfNode:class extends a{constructor(e,t){super(),this.type="IfNode",this.expression=e,this.statement=t}},IfElseNode:class extends a{constructor(e,t,n){super(),this.type="IfElseNode",this.expression=e,this.statement=t,this.elseStatement=n}},ElseNode:class extends a{constructor(e){super(),this.type="ElseNode",this.statement=e}},ElseIfNode:class extends a{constructor(e,t,n){super(),this.type="ElseIfNode",this.expression=e,this.statement=t,this.elseStatement=n}},GenericCommandNode:class extends c{constructor(e,t,n=[]){super(),this.type="GenericCommandNode",this.command=e,this.hashtags=n,this.lineNum=t.first_line}},JumpCommandNode:class extends c{constructor(e){super(),this.type="JumpCommandNode",this.destination=e}},StopCommandNode:class extends c{constructor(){super(),this.type="StopCommandNode"}},TextNode:class extends s{constructor(e,t,n=[]){super(),this.type="TextNode",this.text=e,this.lineNum=t.first_line,this.hashtags=n}},EscapedCharacterNode:class extends s{constructor(e,t,n=[]){super(),this.type="EscapedCharacterNode",this.text=e,this.lineNum=t.first_line,this.hashtags=n}},NumericLiteralNode:class extends o{constructor(e){super(),this.type="NumericLiteralNode",this.numericLiteral=e}},StringLiteralNode:class extends o{constructor(e){super(),this.type="StringLiteralNode",this.stringLiteral=e}},BooleanLiteralNode:class extends o{constructor(e){super(),this.type="BooleanLiteralNode",this.booleanLiteral=e}},VariableNode:class extends o{constructor(e){super(),this.type="VariableNode",this.variableName=e}},UnaryMinusExpressionNode:class extends l{constructor(e){super(),this.type="UnaryMinusExpressionNode",this.expression=e}},ArithmeticExpressionAddNode:class extends l{constructor(e,t){super(),this.type="ArithmeticExpressionAddNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionMinusNode:class extends l{constructor(e,t){super(),this.type="ArithmeticExpressionMinusNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionMultiplyNode:class extends l{constructor(e,t){super(),this.type="ArithmeticExpressionMultiplyNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionExponentNode:class extends l{constructor(e,t){super(),this.type="ArithmeticExpressionExponentNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionDivideNode:class extends l{constructor(e,t){super(),this.type="ArithmeticExpressionDivideNode",this.expression1=e,this.expression2=t}},ArithmeticExpressionModuloNode:class extends l{constructor(e,t){super(),this.type="ArithmeticExpressionModuloNode",this.expression1=e,this.expression2=t}},NegatedBooleanExpressionNode:class extends l{constructor(e){super(),this.type="NegatedBooleanExpressionNode",this.expression=e}},BooleanOrExpressionNode:class extends l{constructor(e,t){super(),this.type="BooleanOrExpressionNode",this.expression1=e,this.expression2=t}},BooleanAndExpressionNode:class extends l{constructor(e,t){super(),this.type="BooleanAndExpressionNode",this.expression1=e,this.expression2=t}},BooleanXorExpressionNode:class extends l{constructor(e,t){super(),this.type="BooleanXorExpressionNode",this.expression1=e,this.expression2=t}},EqualToExpressionNode:class extends l{constructor(e,t){super(),this.type="EqualToExpressionNode",this.expression1=e,this.expression2=t}},NotEqualToExpressionNode:class extends l{constructor(e,t){super(),this.type="NotEqualToExpressionNode",this.expression1=e,this.expression2=t}},GreaterThanExpressionNode:class extends l{constructor(e,t){super(),this.type="GreaterThanExpressionNode",this.expression1=e,this.expression2=t}},GreaterThanOrEqualToExpressionNode:class extends l{constructor(e,t){super(),this.type="GreaterThanOrEqualToExpressionNode",this.expression1=e,this.expression2=t}},LessThanExpressionNode:class extends l{constructor(e,t){super(),this.type="LessThanExpressionNode",this.expression1=e,this.expression2=t}},LessThanOrEqualToExpressionNode:class extends l{constructor(e,t){super(),this.type="LessThanOrEqualToExpressionNode",this.expression1=e,this.expression2=t}},SetVariableEqualToNode:class extends r{constructor(e,t){super(),this.type="SetVariableEqualToNode",this.variableName=e,this.expression=t}},FunctionCallNode:class extends d{constructor(e,t,n,s=[]){super(),this.type="FunctionCallNode",this.functionName=e,this.args=t,this.lineNum=n.first_line,this.hashtags=s}},InlineExpressionNode:class extends l{constructor(e,t,n=[]){super(),this.type="InlineExpressionNode",this.expression=e,this.lineNum=t.first_line,this.hashtags=n}}},u={Whitespace:null,Indent:null,Dedent:null,EndOfLine:/\n/,EndOfInput:null,Number:/-?[0-9]+(\.[0-9+])?/,String:/"([^"\\]*(?:\\.[^"\\]*)*)"/,BeginCommand:/<</,EndCommand:/>>/,Variable:/\$([A-Za-z0-9_.])+/,ShortcutOption:/->/,Hashtag:/#([^(\s|#|//)]+)/,Comment:/\/\/.*/,OptionStart:/\[\[/,OptionDelimit:/\|/,OptionEnd:/\]\]/,If:/if(?!\w)/,ElseIf:/elseif(?!\w)/,Else:/else(?!\w)/,EndIf:/endif(?!\w)/,Jump:/jump(?!\w)/,Stop:/stop(?!\w)/,Set:/set(?!\w)/,Declare:/declare(?!\w)/,As:/as(?!\w)/,ExplicitType:/(String|Number|Bool)(?=>>)/,True:/true(?!\w)/,False:/false(?!\w)/,Null:/null(?!\w)/,LeftParen:/\(/,RightParen:/\)/,Comma:/,/,UnaryMinus:/-(?!\s)/,EqualTo:/(==|is(?!\w)|eq(?!\w))/,GreaterThan:/(>|gt(?!\w))/,GreaterThanOrEqualTo:/(>=|gte(?!\w))/,LessThan:/(<|lt(?!\w))/,LessThanOrEqualTo:/(<=|lte(?!\w))/,NotEqualTo:/(!=|neq(?!\w))/,Or:/(\|\||or(?!\w))/,And:/(&&|and(?!\w))/,Xor:/(\^|xor(?!\w))/,Not:/(!|not(?!\w))/,EqualToOrAssign:/(=|to(?!\w))/,Add:/\+/,Minus:/-/,Exponent:/\*\*/,Multiply:/\*/,Divide:/\//,Modulo:/%/,AddAssign:/\+=/,MinusAssign:/-=/,MultiplyAssign:/\*=/,DivideAssign:/\/=/,Identifier:/[a-zA-Z0-9_:.]+/,EscapedCharacter:/\\./,Text:/[^\\]/,BeginInlineExp:/{/,EndInlineExp:/}/},p=class{constructor(){this.transitions=[],this.textRule=null,this.isTrackingNextIndentation=!1}addTransition(e,t,n){return this.transitions.push({token:e,regex:u[e],state:t||null,delimitsText:n||!1}),this}addTextRule(e,t){if(this.textRule)throw new Error("Cannot add more than one text rule to a state.");const n=[];this.transitions.forEach((e=>{e.delimitsText&&n.push(`(${e.regex.source})`)}));const s=`((?!${n.join("|")}).)+`;return this.addTransition(e,t),this.textRule=this.transitions[this.transitions.length-1],this.textRule.regex=new RegExp(s),this}setTrackNextIndentation(e){return this.isTrackingNextIndentation=e,this}},m=function(){return{base:(new p).addTransition("EscapedCharacter",null,!0).addTransition("Comment",null,!0).addTransition("Hashtag",null,!0).addTransition("BeginCommand","command",!0).addTransition("BeginInlineExp","inlineExpression",!0).addTransition("ShortcutOption","shortcutOption").addTextRule("Text"),shortcutOption:(new p).setTrackNextIndentation(!0).addTransition("EscapedCharacter",null,!0).addTransition("Comment",null,!0).addTransition("Hashtag",null,!0).addTransition("BeginCommand","expression",!0).addTransition("BeginInlineExp","inlineExpressionInShortcut",!0).addTextRule("Text","base"),command:(new p).addTransition("If","expression").addTransition("Else").addTransition("ElseIf","expression").addTransition("EndIf").addTransition("Set","assignment").addTransition("Declare","declare").addTransition("Jump","jump").addTransition("Stop","stop").addTransition("BeginInlineExp","inlineExpressionInCommand",!0).addTransition("EndCommand","base",!0).addTextRule("Text"),commandArg:(new p).addTextRule("Text"),commandParenArgOrExpression:(new p).addTransition("EndCommand","base",!0).addTransition("LeftParen","expression").addTransition("Variable","expression").addTransition("Number","expression").addTransition("String").addTransition("True").addTransition("False").addTransition("Null").addTransition("RightParen"),assignment:(new p).addTransition("Variable").addTransition("EqualToOrAssign","expression"),declare:(new p).addTransition("Variable").addTransition("EndCommand","base").addTransition("EqualToOrAssign","expression"),jump:(new p).addTransition("Identifier").addTransition("BeginInlineExp","inlineExpressionInCommand",!0).addTransition("EndCommand","base",!0),stop:(new p).addTransition("EndCommand","base",!0),expression:(new p).addTransition("As").addTransition("ExplicitType").addTransition("EndCommand","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule(),inlineExpression:(new p).addTransition("EndInlineExp","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule("Text","base"),inlineExpressionInCommand:(new p).addTransition("EndInlineExp","command").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule("Text","base"),inlineExpressionInShortcut:(new p).addTransition("EndInlineExp","shortcutOption").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("UnaryMinus").addTransition("Minus").addTransition("Exponent").addTransition("Multiply").addTransition("Divide").addTransition("Modulo").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule("Text","base")}},x=function(e,t,n,s){for(n=n||{},s=e.length;s--;n[e[s]]=t);return n},f=[1,6],T=[1,17],y=[1,18],E=[1,13],g=[1,20],N=[1,19],v=[5,8,18,19,23,34,36,77],b=[1,24],w=[5,18,19,23,34,36,77],O=[1,25],C=[1,27],_=[1,28],L=[5,8,9,18,19,21,23,34,36,77],k=[1,32],$=[1,36],A=[1,37],I=[1,38],S=[1,39],q=[5,8,9,18,19,21,23,26,34,36,77],R=[1,52],M=[1,51],j=[1,46],B=[1,47],D=[1,48],P=[1,53],G=[1,54],F=[1,55],V=[1,56],H=[1,57],U=[5,8,9,18,19,23,34,36,77],X=[1,73],J=[1,74],Y=[1,75],z=[1,76],Z=[1,77],W=[1,78],K=[1,79],Q=[1,80],ee=[1,81],te=[1,82],ne=[1,83],se=[1,84],ie=[1,85],ae=[1,86],re=[1,87],oe=[26,46,51,53,54,55,56,57,58,60,61,62,63,64,65,66,67,68,70,78],le=[26,46,51,53,54,55,56,57,60,61,62,63,64,65,66,67,68,70,78],de=[26,46,51,70,78],ce=[1,124],he=[1,125],ue=[26,46,51,53,54,60,61,62,63,64,65,66,67,68,70,78],pe=[26,46,51,60,61,62,63,64,65,66,67,68,70,78],me=[51,70],xe=[8,9,18,19,23,34,77],fe={trace:function(){},yy:{},symbols_:{error:2,node:3,statements:4,EndOfInput:5,conditionalBlock:6,statement:7,Comment:8,EndOfLine:9,text:10,shortcut:11,genericCommand:12,assignmentCommand:13,jumpCommand:14,stopCommand:15,hashtags:16,textNode:17,Text:18,EscapedCharacter:19,inlineExpression:20,Hashtag:21,conditional:22,BeginCommand:23,If:24,expression:25,EndCommand:26,EndIf:27,additionalConditionalBlocks:28,else:29,Else:30,elseif:31,ElseIf:32,shortcutOption:33,ShortcutOption:34,Indent:35,Dedent:36,Jump:37,Identifier:38,Stop:39,setCommandInner:40,declareCommandInner:41,Set:42,Variable:43,EqualToOrAssign:44,Declare:45,As:46,ExplicitType:47,functionArgument:48,functionCall:49,LeftParen:50,RightParen:51,UnaryMinus:52,Add:53,Minus:54,Exponent:55,Multiply:56,Divide:57,Modulo:58,Not:59,Or:60,And:61,Xor:62,EqualTo:63,NotEqualTo:64,GreaterThan:65,GreaterThanOrEqualTo:66,LessThan:67,LessThanOrEqualTo:68,parenExpressionArgs:69,Comma:70,literal:71,True:72,False:73,Number:74,String:75,Null:76,BeginInlineExp:77,EndInlineExp:78,$accept:0,$end:1},terminals_:{2:"error",5:"EndOfInput",8:"Comment",9:"EndOfLine",18:"Text",19:"EscapedCharacter",21:"Hashtag",23:"BeginCommand",24:"If",26:"EndCommand",27:"EndIf",30:"Else",32:"ElseIf",34:"ShortcutOption",35:"Indent",36:"Dedent",37:"Jump",38:"Identifier",39:"Stop",42:"Set",43:"Variable",44:"EqualToOrAssign",45:"Declare",46:"As",47:"ExplicitType",50:"LeftParen",51:"RightParen",52:"UnaryMinus",53:"Add",54:"Minus",55:"Exponent",56:"Multiply",57:"Divide",58:"Modulo",59:"Not",60:"Or",61:"And",62:"Xor",63:"EqualTo",64:"NotEqualTo",65:"GreaterThan",66:"GreaterThanOrEqualTo",67:"LessThan",68:"LessThanOrEqualTo",70:"Comma",72:"True",73:"False",74:"Number",75:"String",76:"Null",77:"BeginInlineExp",78:"EndInlineExp"},productions_:[0,[3,2],[4,1],[4,2],[4,1],[4,2],[7,2],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,2],[7,2],[7,2],[17,1],[17,1],[10,1],[10,1],[10,2],[16,1],[16,2],[22,4],[6,6],[6,4],[6,2],[29,3],[29,2],[31,4],[31,2],[28,5],[28,5],[28,3],[33,2],[33,3],[33,2],[33,2],[33,3],[33,2],[11,1],[11,5],[12,3],[14,4],[14,4],[15,3],[13,3],[13,3],[40,4],[41,4],[41,6],[25,1],[25,1],[25,3],[25,2],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,2],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[25,3],[49,3],[49,4],[69,3],[69,1],[48,1],[48,1],[48,1],[71,1],[71,1],[71,1],[71,1],[71,1],[20,3]],performAction:function(e,t,n,s,i,a,r){var o=a.length-1;switch(i){case 1:return a[o-1].flat();case 2:case 4:case 8:case 9:case 10:case 11:case 12:case 18:case 19:case 74:this.$=[a[o]];break;case 3:case 20:this.$=a[o-1].concat(a[o]);break;case 5:this.$=a[o-1].concat([a[o]]);break;case 6:case 27:case 28:this.$=void 0;break;case 7:case 52:case 51:case 75:case 76:this.$=a[o];break;case 13:case 15:case 26:case 29:case 30:case 46:case 53:case 23:case 37:case 39:this.$=a[o-1];break;case 14:this.$=a[o-1].map((e=>Object.assign(e,{hashtags:a[o]})));break;case 16:this.$=new s.TextNode(a[o],this._$);break;case 17:this.$=new s.EscapedCharacterNode(a[o],this._$);break;case 21:this.$=[a[o].substring(1)];break;case 22:this.$=[a[o-1].substring(1)].concat(a[o]);break;case 24:this.$=new s.IfNode(a[o-5],a[o-3].flat());break;case 25:this.$=new s.IfElseNode(a[o-3],a[o-1].flat(),a[o]);break;case 31:this.$=new s.ElseNode(a[o-3].flat());break;case 32:this.$=new s.ElseIfNode(a[o-4],a[o-3].flat());break;case 33:this.$=new s.ElseIfNode(a[o-2],a[o-1].flat(),a[o]);break;case 34:this.$={text:a[o]};break;case 35:this.$={text:a[o-1],conditional:a[o]};break;case 36:this.$={...a[o-1],hashtags:a[o]};break;case 38:this.$={...a[o-2],hashtags:a[o-1]};break;case 40:this.$=new s.DialogShortcutNode(a[o].text,void 0,this._$,a[o].hashtags,a[o].conditional);break;case 41:this.$=new s.DialogShortcutNode(a[o-4].text,a[o-1].flat(),this._$,a[o-4].hashtags,a[o-4].conditional);break;case 42:this.$=new s.GenericCommandNode(a[o-1],this._$);break;case 43:case 44:this.$=new s.JumpCommandNode(a[o-1]);break;case 45:this.$=new s.StopCommandNode;break;case 47:this.$=null;break;case 48:this.$=new s.SetVariableEqualToNode(a[o-2].substring(1),a[o]);break;case 49:this.$=null,s.registerDeclaration(a[o-2].substring(1),a[o]);break;case 50:this.$=null,s.registerDeclaration(a[o-4].substring(1),a[o-2],a[o]);break;case 54:this.$=new s.UnaryMinusExpressionNode(a[o]);break;case 55:this.$=new s.ArithmeticExpressionAddNode(a[o-2],a[o]);break;case 56:this.$=new s.ArithmeticExpressionMinusNode(a[o-2],a[o]);break;case 57:this.$=new s.ArithmeticExpressionExponentNode(a[o-2],a[o]);break;case 58:this.$=new s.ArithmeticExpressionMultiplyNode(a[o-2],a[o]);break;case 59:this.$=new s.ArithmeticExpressionDivideNode(a[o-2],a[o]);break;case 60:this.$=new s.ArithmeticExpressionModuloNode(a[o-2],a[o]);break;case 61:this.$=new s.NegatedBooleanExpressionNode(a[o]);break;case 62:this.$=new s.BooleanOrExpressionNode(a[o-2],a[o]);break;case 63:this.$=new s.BooleanAndExpressionNode(a[o-2],a[o]);break;case 64:this.$=new s.BooleanXorExpressionNode(a[o-2],a[o]);break;case 65:this.$=new s.EqualToExpressionNode(a[o-2],a[o]);break;case 66:this.$=new s.NotEqualToExpressionNode(a[o-2],a[o]);break;case 67:this.$=new s.GreaterThanExpressionNode(a[o-2],a[o]);break;case 68:this.$=new s.GreaterThanOrEqualToExpressionNode(a[o-2],a[o]);break;case 69:this.$=new s.LessThanExpressionNode(a[o-2],a[o]);break;case 70:this.$=new s.LessThanOrEqualToExpressionNode(a[o-2],a[o]);break;case 71:this.$=new s.FunctionCallNode(a[o-2],[],this._$);break;case 72:this.$=new s.FunctionCallNode(a[o-3],a[o-1],this._$);break;case 73:this.$=a[o-2].concat([a[o]]);break;case 77:this.$=new s.VariableNode(a[o].substring(1));break;case 78:case 79:this.$=new s.BooleanLiteralNode(a[o]);break;case 80:this.$=new s.NumericLiteralNode(a[o]);break;case 81:this.$=new s.StringLiteralNode(a[o]);break;case 82:this.$=new s.NullLiteralNode(a[o]);break;case 83:this.$=new s.InlineExpressionNode(a[o-1],this._$)}},table:[{3:1,4:2,6:3,7:4,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,77:N},{1:[3]},{5:[1,21],6:22,7:23,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,77:N},x(v,[2,2],{9:b}),x(w,[2,4],{16:26,8:O,9:C,21:_}),{9:[1,29]},{9:[1,30]},x([5,8,9,21,23,34,36],[2,7],{17:14,20:15,10:31,18:T,19:y,77:N}),x(L,[2,8]),x(L,[2,9]),x(L,[2,10]),x(L,[2,11]),x(L,[2,12]),{10:33,17:14,18:T,19:y,20:15,24:k,37:$,39:A,40:34,41:35,42:I,45:S,77:N},x(q,[2,18]),x(q,[2,19]),x(w,[2,40],{16:41,8:[1,42],9:[1,40],21:_}),x(q,[2,16]),x(q,[2,17]),{20:49,25:43,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{10:58,17:14,18:T,19:y,20:15,77:N},{1:[2,1]},x(v,[2,3],{9:b}),x(w,[2,5],{16:26,8:O,9:C,21:_}),x(U,[2,26]),x(L,[2,13]),x(L,[2,14]),x(L,[2,15]),x(U,[2,21],{16:59,21:_}),{4:60,6:3,7:4,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,77:N},x(L,[2,6]),x([5,8,9,21,23,26,34,36],[2,20],{17:14,20:15,10:31,18:T,19:y,77:N}),{20:49,25:61,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{10:31,17:14,18:T,19:y,20:15,26:[1,62],77:N},{26:[1,63]},{26:[1,64]},{20:66,38:[1,65],77:N},{26:[1,67]},{43:[1,68]},{43:[1,69]},x(L,[2,39],{35:[1,70]}),x([5,9,18,19,21,23,34,36,77],[2,36],{8:[1,71]}),x(L,[2,37]),{53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re,78:[1,72]},x(oe,[2,51]),x(oe,[2,52]),{20:49,25:88,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:89,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:90,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},x(oe,[2,75]),x(oe,[2,76]),x(oe,[2,77]),{50:[1,91]},x(oe,[2,78]),x(oe,[2,79]),x(oe,[2,80]),x(oe,[2,81]),x(oe,[2,82]),x([5,8,9,21,34,36],[2,34],{17:14,20:15,10:31,22:92,18:T,19:y,23:[1,93],77:N}),x(L,[2,22]),{6:22,7:23,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:[1,94],28:95,29:96,31:97,33:16,34:g,77:N},{26:[1,98],53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re},x(L,[2,42]),x(L,[2,46]),x(L,[2,47]),{26:[1,99]},{26:[1,100]},x(L,[2,45]),{44:[1,101]},{44:[1,102]},{4:103,6:3,7:4,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,77:N},x(L,[2,38]),x([5,8,9,18,19,21,23,26,34,36,46,51,53,54,55,56,57,58,60,61,62,63,64,65,66,67,68,70,77,78],[2,83]),{20:49,25:104,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:105,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:106,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:107,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:108,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:109,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:110,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:111,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:112,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:113,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:114,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:115,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:116,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:117,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:118,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{51:[1,119],53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re},x(le,[2,54],{58:W}),x(de,[2,61],{53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re}),{20:49,25:122,38:R,43:M,48:44,49:45,50:j,51:[1,120],52:B,59:D,69:121,71:50,72:P,73:G,74:F,75:V,76:H,77:N},x(L,[2,35]),{24:k},{10:33,17:14,18:T,19:y,20:15,24:k,27:[1,123],30:ce,32:he,37:$,39:A,40:34,41:35,42:I,45:S,77:N},x(U,[2,25]),{4:126,6:3,7:4,8:f,9:[1,127],10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,77:N},{4:128,6:3,7:4,8:f,9:[1,129],10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,77:N},x(L,[2,23]),x(L,[2,43]),x(L,[2,44]),{20:49,25:130,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{20:49,25:131,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{6:22,7:23,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:E,33:16,34:g,36:[1,132],77:N},x(ue,[2,55],{55:Y,56:z,57:Z,58:W}),x(ue,[2,56],{55:Y,56:z,57:Z,58:W}),x(le,[2,57],{58:W}),x(le,[2,58],{58:W}),x(le,[2,59],{58:W}),x(de,[2,60],{53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re}),x([26,46,51,60,70,78],[2,62],{53:X,54:J,55:Y,56:z,57:Z,58:W,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re}),x([26,46,51,60,61,70,78],[2,63],{53:X,54:J,55:Y,56:z,57:Z,58:W,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re}),x([26,46,51,60,61,62,70,78],[2,64],{53:X,54:J,55:Y,56:z,57:Z,58:W,63:te,64:ne,65:se,66:ie,67:ae,68:re}),x(pe,[2,65],{53:X,54:J,55:Y,56:z,57:Z,58:W}),x(pe,[2,66],{53:X,54:J,55:Y,56:z,57:Z,58:W}),x(pe,[2,67],{53:X,54:J,55:Y,56:z,57:Z,58:W}),x(pe,[2,68],{53:X,54:J,55:Y,56:z,57:Z,58:W}),x(pe,[2,69],{53:X,54:J,55:Y,56:z,57:Z,58:W}),x(pe,[2,70],{53:X,54:J,55:Y,56:z,57:Z,58:W}),x(oe,[2,53]),x(oe,[2,71]),{51:[1,133],70:[1,134]},x(me,[2,74],{53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re}),{26:[1,135]},{26:[1,136]},{20:49,25:137,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},{6:22,7:23,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:[1,138],33:16,34:g,77:N},x(xe,[2,28]),{6:22,7:23,8:f,10:7,11:8,12:9,13:10,14:11,15:12,17:14,18:T,19:y,20:15,22:5,23:[1,139],28:140,29:96,31:97,33:16,34:g,77:N},x(xe,[2,30]),{26:[2,48],53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re},{26:[2,49],46:[1,141],53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re},x(L,[2,41]),x(oe,[2,72]),{20:49,25:142,38:R,43:M,48:44,49:45,50:j,52:B,59:D,71:50,72:P,73:G,74:F,75:V,76:H,77:N},x(U,[2,24]),x(xe,[2,27]),{26:[1,143],53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re},{10:33,17:14,18:T,19:y,20:15,24:k,27:[1,144],37:$,39:A,40:34,41:35,42:I,45:S,77:N},{10:33,17:14,18:T,19:y,20:15,24:k,27:[1,145],30:ce,32:he,37:$,39:A,40:34,41:35,42:I,45:S,77:N},x(U,[2,33]),{47:[1,146]},x(me,[2,73],{53:X,54:J,55:Y,56:z,57:Z,58:W,60:K,61:Q,62:ee,63:te,64:ne,65:se,66:ie,67:ae,68:re}),x(xe,[2,29]),{26:[1,147]},{26:[1,148]},{26:[2,50]},x(U,[2,31]),x(U,[2,32])],defaultActions:{21:[2,1],146:[2,50]},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],s=[null],i=[],a=this.table,r="",o=0,l=0,d=0,c=i.slice.call(arguments,1),h=Object.create(this.lexer),u={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(u.yy[p]=this.yy[p]);h.setInput(e,u.yy),u.yy.lexer=h,u.yy.parser=this,void 0===h.yylloc&&(h.yylloc={});var m=h.yylloc;i.push(m);var x,f=h.options&&h.options.ranges;"function"==typeof u.yy.parseError?this.parseError=u.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var T,y,E,g,N,v,b,w,O,C={};;){if(E=n[n.length-1],this.defaultActions[E]?g=this.defaultActions[E]:(null==T&&(x=void 0,"number"!=typeof(x=h.lex()||1)&&(x=t.symbols_[x]||x),T=x),g=a[E]&&a[E][T]),void 0===g||!g.length||!g[0]){var _;for(v in O=[],a[E])this.terminals_[v]&&v>2&&O.push("'"+this.terminals_[v]+"'");_=h.showPosition?"Parse error on line "+(o+1)+":\n"+h.showPosition()+"\nExpecting "+O.join(", ")+", got '"+(this.terminals_[T]||T)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==T?"end of input":"'"+(this.terminals_[T]||T)+"'"),this.parseError(_,{text:h.match,token:this.terminals_[T]||T,line:h.yylineno,loc:m,expected:O})}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+E+", token: "+T);switch(g[0]){case 1:n.push(T),s.push(h.yytext),i.push(h.yylloc),n.push(g[1]),T=null,y?(T=y,y=null):(l=h.yyleng,r=h.yytext,o=h.yylineno,m=h.yylloc,d>0&&d--);break;case 2:if(b=this.productions_[g[1]][1],C.$=s[s.length-b],C._$={first_line:i[i.length-(b||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(b||1)].first_column,last_column:i[i.length-1].last_column},f&&(C._$.range=[i[i.length-(b||1)].range[0],i[i.length-1].range[1]]),void 0!==(N=this.performAction.apply(C,[r,l,o,u.yy,g[1],s,i].concat(c))))return N;b&&(n=n.slice(0,-1*b*2),s=s.slice(0,-1*b),i=i.slice(0,-1*b)),n.push(this.productions_[g[1]][0]),s.push(C.$),i.push(C._$),w=a[n[n.length-2]][n[n.length-1]],n.push(w);break;case 3:return!0}}return!0}};function Te(){this.yy={}}Te.prototype=fe,fe.Parser=Te,fe.lexer=new class{constructor(){this.states=m(),this.state="base",this.originalText="",this.lines=[],this.indentation=[[0,!1]],this.shouldTrackNextIndentation=!1,this.previousLevelOfIndentation=0,this.reset()}reset(){this.yytext="",this.yylloc={first_column:1,first_line:1,last_column:1,last_line:1},this.yylineno=1}lex(){if(this.isAtTheEndOfText()){this.yytext="";const e=this.indentation.pop();return e&&e[1]?"Dedent":"EndOfInput"}return this.isAtTheEndOfLine()?(this.advanceLine(),"EndOfLine"):this.lexNextTokenOnCurrentLine()}advanceLine(){this.yylineno+=1;const e=this.getCurrentLine();this.lines[this.yylineno-1]=e,this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],this.yytext="",this.yylloc={first_column:1,first_line:this.yylineno,last_column:1,last_line:this.yylineno}}lexNextTokenOnCurrentLine(){const e=this.getCurrentLineIndentation();if(this.shouldTrackNextIndentation&&this.yylloc.first_column===this.yylloc.last_column&&e>this.previousLevelOfIndentation)return this.indentation.push([e,!0]),this.shouldTrackNextIndentation=!1,this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=e,this.yytext="","Indent";if(e<this.getLastRecordedIndentation()[0]&&this.indentation.pop()[1]&&this.yylloc.first_column===this.yylloc.last_column)return this.yytext="",this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],"Dedent";e===this.previousLevelOfIndentation&&1===this.yylloc.last_column&&(this.yylloc.last_column+=e);let t=this.getState().transitions.find((e=>{const t=this.getCurrentLine().substring(this.yylloc.last_column-1).match(e.regex);return null!==t&&0===t.index})),n=this.getCurrentLine().substring(this.yylloc.last_column-1).match(t.regex);if(1===this.yylloc.last_column&&!this.shouldTrackNextIndentation){const e=this.getCurrentLine().substring(this.yylloc.last_column-1).match(/^\s*/);this.yylloc.last_column+=e[0].length,t=this.getState().transitions.find((e=>{const t=this.getCurrentLine().substring(this.yylloc.last_column-1).match(e.regex);return null!==t&&0===t.index})),n=this.getCurrentLine().substring(this.yylloc.last_column-1).match(t.regex)}const s=n[0];this.yytext=this.getCurrentLine().substr(this.yylloc.last_column-1,s.length),"String"===t.token&&(this.yytext=this.yytext.substring(1,this.yytext.length-1)),this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=s.length,t.state&&(this.setState(t.state),this.shouldTrackNextIndentation&&this.getLastRecordedIndentation()[0]<e&&this.indentation.push([e,!1]));const i=this.states[t.state],a=!t.state||i.transitions.find((e=>"Text"===e.token));if("EndInlineExp"!==t.token&&"EscapedCharacter"!==t.token||!a){const e=this.getCurrentLine().substring(this.yylloc.last_column-1).match(/^\s*/);e[0]&&(this.yylloc.last_column+=e[0].length)}return t.token}setState(e){if(void 0===this.states[e])throw new Error(`Cannot set the unknown state [${e}]`);this.state=e,this.getState().isTrackingNextIndentation&&(this.shouldTrackNextIndentation=!0)}setInput(e){this.originalText=e.replace(/(\r\n)/g,"\n").replace(/\r/g,"\n").replace(/[\n\r]+$/,""),this.lines=this.originalText.split("\n").map((e=>e.replace(/\t/,"    "))),this.reset()}getState(){return this.states[this.state]}getCurrentLine(){return this.lines[this.yylineno-1]}getCurrentLineIndentation(){return this.getCurrentLine().match(/^(\s*)/g)[0].length}getLastRecordedIndentation(){return 0===this.indentation.length?[0,!1]:this.indentation[this.indentation.length-1]}isAtTheEndOfText(){return this.isAtTheEndOfLine()&&this.yylloc.first_line>=this.lines.length}isAtTheEndOfLine(){return this.yylloc.last_column>this.getCurrentLine().length}},fe.yy=h,fe.yy.declarations={},fe.yy.parseError=function(e){throw e},fe.yy.registerDeclaration=function(e,t,n){if(!this.areDeclarationsHandled){if(this.declarations[e])throw new Error(`Duplicate declaration found for variable: ${e}`);this.declarations[e]={variableName:e,expression:t,explicitType:n}}};var ye=fe;class Ee{}class ge extends Ee{constructor(e,t=!0,n=[],s){super(),this.text=e,this.isAvailable=t,this.hashtags=n,this.metadata=s}}var Ne=class extends Ee{constructor(e,t,n){super(),this.text=e,this.hashtags=t,this.metadata=n}},ve=class extends Ee{constructor(e,t,n){super(),this.command=e,this.hashtags=t,this.metadata=n}},be=class extends Ee{constructor(e,t){super(),this.options=e.map((e=>new ge(e.text,e.isAvailable,e.hashtags))),this.metadata=t}select(e=-1){if(e<0||e>=this.options.length)throw new Error(`Cannot select option #${e}, there are ${this.options.length} options`);this.selected=e}},we=class{constructor(){this.data={}}set(e,t){this.data[e]=t}get(e){return this.data[e]}};const Oe=h.types;var Ce={Runner:class{constructor(){this.noEscape=!1,this.lookahead=!1,this.yarnNodes={},this.variables=new we,this.functions={}}load(e){if(!e)throw new Error("No dialogue supplied");let t;t="string"==typeof e?function(e){const t=[],n=e.split(/\r?\n+/).filter((e=>!e.match(/^\s*$/)));let s,i=null,a=!1,r="",o=0;for(;"#"===n[o].trim()[0];)s||(s=[]),s.push(n[o].trim().substr(1)),o+=1;for(;o<n.length;o+=1)if("==="===n[o].trim())a=!1,s&&(i.filetags=s),t.push(i),i=null;else if(a)i.body+=`${n[o].replace(r,"")}\n`;else if("---"===n[o].trim())a=!0,i.body="",r=n[o].match(/^\s*/)[0];else if(n[o].indexOf(":")>-1){const[e,t]=n[o].split(":"),s=e.trim(),a=t.trim();if("body"!==s){if(null==i&&(i={}),i[s])throw new Error(`Duplicate tag on node: ${s}`);i[s]=a}}return t}(e):e,t.forEach((e=>{if(!e.title)throw new Error(`Node needs a title: ${JSON.stringify(e)}`);if(e.title.split(".").length>1)throw new Error(`Node title cannot contain a dot: ${e.title}`);if(!e.body)throw new Error(`Node needs a body: ${JSON.stringify(e)}`);if(this.yarnNodes[e.title])throw new Error(`Duplicate node title: ${e.title}`);this.yarnNodes[e.title]=e})),ye.yy.areDeclarationsHandled=!1,ye.yy.declarations={},this.handleDeclarations(t),ye.yy.areDeclarationsHandled=!0}setVariableStorage(e){if("function"!=typeof e.set||"function"!=typeof e.get)throw new Error('Variable Storage object must contain both a "set" and "get" function');this.variables=e}handleDeclarations(e){const t={Number:0,String:"",Boolean:!1},n=e.reduce(((e,t)=>[...e,...t.body.split(/\r?\n+/)]),[]).reduce(((e,t)=>t.match(/^<<declare .+>>/)?[...e,t]:e),[]);n.length&&ye.parse(n.join("\n")),Object.entries(ye.yy.declarations).forEach((([e,{expression:n,explicitType:s}])=>{const i=this.evaluateExpressionOrLiteral(n);if(s&&typeof i!=typeof t[s])throw new Error(`Cannot declare value ${i} as type ${s} for variable ${e}`);this.variables.get(e)||this.variables.set(e,i)}))}registerFunction(e,t){if("function"!=typeof t)throw new Error("Registered function must be...well...a function");this.functions[e]=t}*run(e){const{parserNodes:t,metadata:n}=this.getParserNodes(e);return yield*this.evalNodes(t,n)}getParserNodes(e){const t=this.yarnNodes[e];if(void 0===t)throw new Error(`Node "${e}" does not exist`);const n=Array.from(ye.parse(t.body)),s={...t};return delete s.body,{parserNodes:n,metadata:s}}*evalNodes(e,t,n=[],s=[]){const i=e.filter(Boolean),a=[...s],r=[...n],o=[...e],l=()=>this.evalNodes(o,t,r,a),d=i[0],c=i[1];if(d instanceof Oe.Text||d instanceof Oe.Expression)if(s.push(d),c&&d.lineNum===c.lineNum&&(c instanceof Oe.Text||c instanceof Oe.Expression));else{const e=s.reduce(((e,t)=>e+this.evaluateExpressionOrLiteral(t).toString()),"");s=[];const n=Object.assign(new Ne(e,d.hashtags,t),{getGeneratorHere:l});if(1===i.length)return n;yield n}else if(d instanceof Oe.Shortcut){if(n.push(d),!(c instanceof Oe.Shortcut))return yield*this.handleShortcuts(n,t,i.slice(1),l)}else if(d instanceof Oe.Assignment)this.lookahead||this.evaluateAssignment(d);else if(d instanceof Oe.Conditional){const e=this.evaluateConditional(d);if(e)return yield*this.evalNodes([...e,...i.slice(1)],t,n,s)}else{if(d instanceof h.JumpCommandNode){const e=d.destination instanceof h.InlineExpressionNode?this.evaluateExpressionOrLiteral(d.destination):d.destination,{parserNodes:t,metadata:n}=this.getParserNodes(e);return yield*this.evalNodes(t,n)}if(d instanceof h.StopCommandNode)return;{const e=this.evaluateExpressionOrLiteral(d.command),n=Object.assign(new ve(e,d.hashtags,t),{getGeneratorHere:l});if(1===i.length)return n;yield n}}if(i.length>1)return yield*this.evalNodes(i.slice(1),t,n,s)}*handleShortcuts(e,t,n,s){const i=e.map((e=>{let t=!0;e.conditionalExpression&&!this.evaluateExpressionOrLiteral(e.conditionalExpression)&&(t=!1);const n=this.evaluateExpressionOrLiteral(e.text);return Object.assign(e,{isAvailable:t,text:n})})),a=Object.assign(new be(i,t),{getGeneratorHere:s});if(yield a,"number"!=typeof a.selected)throw new Error("No option selected before resuming dialogue");const r=i[a.selected];return r.content?yield*this.evalNodes([...r.content,...n],t):n.length?yield*this.evalNodes(n,t):void 0}evaluateAssignment(e){const t=this.evaluateExpressionOrLiteral(e.expression),n=this.variables.get(e.variableName);if(n&&typeof n!=typeof t)throw new Error(`Variable ${e.variableName} is already type ${typeof n}; cannot set equal to ${t} of type ${typeof t}`);this.variables.set(e.variableName,t)}evaluateConditional(e){if("IfNode"===e.type){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement}else{if("IfElseNode"!==e.type&&"ElseIfNode"!==e.type)return e.statement;if(this.evaluateExpressionOrLiteral(e.expression))return e.statement;if(e.elseStatement)return this.evaluateConditional(e.elseStatement)}return null}evaluateFunctionCall(e){if(this.functions[e.functionName])return this.functions[e.functionName](...e.args.map(this.evaluateExpressionOrLiteral,this));throw new Error(`Function "${e.functionName}" not found`)}evaluateExpressionOrLiteral(e){if(Array.isArray(e))return e.reduce(((e,t)=>e+this.evaluateExpressionOrLiteral(t).toString()),"");if("object"!=typeof e)return e;const t={UnaryMinusExpressionNode:e=>-e,ArithmeticExpressionAddNode:(e,t)=>e+t,ArithmeticExpressionMinusNode:(e,t)=>e-t,ArithmeticExpressionExponentNode:(e,t)=>e**t,ArithmeticExpressionMultiplyNode:(e,t)=>e*t,ArithmeticExpressionDivideNode:(e,t)=>e/t,ArithmeticExpressionModuloNode:(e,t)=>e%t,NegatedBooleanExpressionNode:e=>!e,BooleanOrExpressionNode:(e,t)=>e||t,BooleanAndExpressionNode:(e,t)=>e&&t,BooleanXorExpressionNode:(e,t)=>!!(e^t),EqualToExpressionNode:(e,t)=>e===t,NotEqualToExpressionNode:(e,t)=>e!==t,GreaterThanExpressionNode:(e,t)=>e>t,GreaterThanOrEqualToExpressionNode:(e,t)=>e>=t,LessThanExpressionNode:(e,t)=>e<t,LessThanOrEqualToExpressionNode:(e,t)=>e<=t,TextNode:e=>e.text,EscapedCharacterNode:e=>this.noEscape?e.text:e.text.slice(1),NumericLiteralNode:e=>parseFloat(e.numericLiteral),StringLiteralNode:e=>`${e.stringLiteral}`,BooleanLiteralNode:e=>"true"===e.booleanLiteral,VariableNode:e=>{const t=this.variables.get(e.variableName);if(void 0===t&&!this.lookahead)throw new Error(`Attempted to access undefined variable "${e.variableName}"`);return t},FunctionCallNode:e=>this.evaluateFunctionCall(e),InlineExpressionNode:e=>e}[e.type];if(!t)throw new Error(`node type not recognized: ${e.type}`);return t(e instanceof Oe.Expression?this.evaluateExpressionOrLiteral(e.expression||e.expression1):e,e.expression2?this.evaluateExpressionOrLiteral(e.expression2):e)}},TextResult:Ne,CommandResult:ve,OptionsResult:be};Ce.OptionsResult=be,Ce.TextResult=Ne,Ce.CommandResult=ve;var _e=Ce},729:function(e){var t=Object.prototype.hasOwnProperty,n="~";function s(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,s,a,r){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new i(s,a||e,r),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function r(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,s,i=[];if(0===this._eventsCount)return i;for(s in e=this._events)t.call(e,s)&&i.push(n?s.slice(1):s);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,a=s.length,r=new Array(a);i<a;i++)r[i]=s[i].fn;return r},o.prototype.listenerCount=function(e){var t=n?n+e:e,s=this._events[t];return s?s.fn?1:s.length:0},o.prototype.emit=function(e,t,s,i,a,r){var o=n?n+e:e;if(!this._events[o])return!1;var l,d,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,i),!0;case 5:return c.fn.call(c.context,t,s,i,a),!0;case 6:return c.fn.call(c.context,t,s,i,a,r),!0}for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var u,p=c.length;for(d=0;d<p;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),h){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,s);break;case 4:c[d].fn.call(c[d].context,t,s,i);break;default:if(!l)for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c[d].fn.apply(c[d].context,l)}}return!0},o.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,s,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return r(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||s&&o.context!==s||r(this,a);else{for(var l=0,d=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||s&&o[l].context!==s)&&d.push(o[l]);d.length?this._events[a]=1===d.length?d[0]:d:r(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&r(this,t)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o},256:function(e,t){function n(e,t){const n=e.match(/^\/?([^\s=/]+)(\/|\s|$)/),s="/"===e[0],i="/"===e[e.length-1];if("/"===e)return{name:"closeall",isCloseAll:!0};if(s)return{name:n[1],isClosing:!0};{const s=(n?e.replace(n[0],""):e).match(/(\S+?".*?"|[^\s/]+)/g);let a={};s&&(a=s.reduce(((e,t)=>Object.assign(Object.assign({},e),function(e){const[t,...n]=e.split("="),s=n.join("=");if(!t||!s)throw new Error(`Invalid markup property assignment: ${e}`);let i;return i="true"===s||"false"===s?"true"===s:/^-?\d*\.?\d+$/.test(s)?+s:'"'===s[0]&&'"'===s[s.length-1]?s.slice(1,-1):s,{[t]:i}}(t))),{}));const r=n&&n[1]||Object.keys(a)[0];let o;return"select"===r?o=function(e){return e[e.value]}(a):"plural"===r?o=function(e,t){return e[new Intl.PluralRules(t).select(e.value)].replace(/%/g,e.value)}(a,t):"ordinal"===r&&(o=function(e,t){return e[new Intl.PluralRules(t,{type:"ordinal"}).select(e.value)].replace(/%/g,e.value)}(a,t)),{name:r,properties:a,isSelfClosing:i,replacement:o}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.markup=[],function(e){const t=e.text.match(/^(\S+):\s+/);t&&(e.text=e.text.replace(t[0],""),e.markup.push({name:"character",properties:{name:t[1]}}))}(e),function(e,t){const s=[];let i=!1;const a=/(^|[^\\])\[(.*?[^\\])\](.|$)/;let r=e.text,o="",l=r.match(a);for(;l;){const{index:e}=l;if(!e)break;const[d,c,h,u]=l,p=/\s/.test(c),m=/\s/.test(u),x=Object.assign(Object.assign({},n(h,t)),{position:o.length+e+c.length});if(i&&"nomarkup"!==x.name)o+=r.slice(0,e+d.length-1),r=r.slice(e+d.length-1);else{const t="select"===x.name||"plural"===x.name||"ordinal"===x.name,n=!t&&x.isSelfClosing&&x.properties&&!1!==x.properties.trimwhitespace&&(0===e&&m||p&&m);x.properties&&delete x.properties.trimwhitespace;const i=c+(x.replacement||"")+(n?u.slice(1):u);r=r.replace(a,i),o+=r.slice(0,e+i.slice(1).length),r=r.slice(e+i.slice(1).length),t||"nomarkup"===x.name||s.push(x)}"nomarkup"===x.name&&(i=!x.isClosing),l=r.match(a)}e.text=o+r;const d=/\\(\[|\])/;for(l=e.text.match(d),r=e.text,o="";l&&void 0!==l.index;){const e=l[1];s.forEach((e=>{e.position&&(null==l?void 0:l.index)&&e.position>o.length+l.index&&(e.position-=1)})),r=r.replace(d,e),o+=r.slice(0,l.index+1),r=r.slice(l.index+1),l=r.match(d)}e.text=o+r;const c={};s.forEach((t=>{if(c[t.name]||(c[t.name]=[]),t.isClosing&&!c[t.name].length)throw new Error(`Encountered closing ${t.name} tag before opening tag`);if(t.isClosing){const n=c[t.name].pop();e.markup.push({name:n.name,position:n.position,properties:n.properties,length:t.position-n.position})}else if(t.isSelfClosing)e.markup.push({name:t.name,position:t.position,properties:t.properties,length:0});else if(t.isCloseAll){const n=Object.values(c).flat();for(;n.length;){const s=n.pop();e.markup.push({name:s.name,position:s.position,properties:s.properties,length:t.position-s.position})}}else c[t.name].push({name:t.name,position:t.position,properties:t.properties})}))}(e,t),e.text=e.text.replace(/(?:\\(.))/g,"$1")}},625:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.YarnBound=void 0;const i=s(n(823)),a=s(n(256)),r=s(n(729));t.YarnBound=class{constructor({dialogue:e,variableStorage:t,functions:n,handleCommand:s,combineTextAndOptionsResults:a,locale:o,pauseCommand:l="pause",startAt:d="Start"}){this.eventEmitter=new r.default,this.addListener=this.eventEmitter.addListener.bind(this.eventEmitter),this.on=this.eventEmitter.on.bind(this.eventEmitter),this.removeListener=this.eventEmitter.removeListener.bind(this.eventEmitter),this.off=this.eventEmitter.off.bind(this.eventEmitter),this.handleCommand=s,this.pauseCommand=l,this.combineTextAndOptionsResults=!!a,this.bondage=i.default,this.currentResult=null,this.history=[],this.locale=o,this.runner=new i.default.Runner,this.runner.noEscape=!0,this.runner.load(e),t&&(t.display=t.display||t.get,this.runner.setVariableStorage(t)),n&&Object.entries(n).forEach((e=>{this.registerFunction(...e)})),this.jump(d)}jump(e){this.generator=this.runner.run(e),this.advance(),this.eventEmitter.emit("advance",this.currentResult)}handleConsecutiveOptionsNodes(e=!1){let t=this.generator.next();for(;t.value instanceof i.default.CommandResult&&t.value.command!==this.pauseCommand;)e&&this.handleCommand&&this.handleCommand(t.value),t=this.generator.next();return t}lookahead(){let e=this.generator.next();if(e.done)return e.value=Object.assign(e.value||{},{isDialogueEnd:!0}),e;if(e.done||e.value&&e.value.command===this.pauseCommand||e.value instanceof i.default.OptionsResult)return e;this.handleCommand&&e.value instanceof i.default.CommandResult&&e.value.command!==this.pauseCommand&&(this.handleCommand(e.value),e=this.handleConsecutiveOptionsNodes(!0)),this.runner.lookahead=!0;let t=this.generator.next();if(this.handleCommand&&t.value instanceof i.default.CommandResult&&t.value.command!==this.pauseCommand){t=this.handleConsecutiveOptionsNodes(),this.generator=e.value.getGeneratorHere(),this.runner.lookahead=!1;const n=e.value instanceof i.default.CommandResult?this.handleConsecutiveOptionsNodes(!0):this.generator.next();return t.value||(t=this.handleConsecutiveOptionsNodes(!0),t.value?this.generator=t.value.getGeneratorHere():Object.assign(n.value,{isDialogueEnd:!0})),n}if(e.value instanceof i.default.TextResult&&this.combineTextAndOptionsResults&&t.value instanceof i.default.OptionsResult){this.generator=e.value.getGeneratorHere(),this.runner.lookahead=!1;const t=this.generator.next(),n=this.generator.next();return Object.assign(n.value,t.value),n}{this.generator=e.value.getGeneratorHere(),this.runner.lookahead=!1;const n=this.generator.next();return t.value||Object.assign(n.value,{isDialogueEnd:!0}),n}}advance(e){void 0!==e&&this.currentResult&&this.currentResult.select&&this.currentResult.select(e);const t=this.lookahead();[t.value.text&&t.value,...t.value.options||[]].filter(Boolean).forEach((e=>(0,a.default)(e,this.locale))),!this.currentResult||this.handleCommand&&this.currentResult instanceof i.default.CommandResult||this.history.push(this.currentResult),this.currentResult=t.value}registerFunction(e,t){this.runner.registerFunction(e,t)}}}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return function(){var e=s;Object.defineProperty(e,"__esModule",{value:!0}),e.YarnBound=void 0;var t=n(625);Object.defineProperty(e,"YarnBound",{enumerable:!0,get:function(){return t.YarnBound}})}(),s}()}));